<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Alumnos</title>
  <style>
    table { border-collapse: collapse; width: 90%; margin: 20px auto; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: left; }
    form { margin: 20px auto; width: 90%; display: flex; gap: 10px; flex-wrap: wrap; }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Lista de Alumnos</h2>

  <form id="alumnoForm">
    <input id="lu" placeholder="LU" required />
    <input id="nombre" placeholder="Nombre" required />
    <input id="apellido" placeholder="Apellido" required />
    <input id="titulo" placeholder="Título" />
    <input id="titulo_en_tramite" placeholder="Título en trámite" />
    <input id="egreso" placeholder="Egreso" />
    <button type="submit">Agregar Alumno</button>
  </form>

  <table id="alumnosTable">
    <thead>
      <tr>
      <th>LU <button onclick="ordenarPor('lu')">↓</button></th>
      <th>Nombre <button onclick="ordenarPor('nombre')">↓</button></th>
      <th>Apellido <button onclick="ordenarPor('apellido')">↓</button></th>
      <th>Título <button onclick="ordenarPor('titulo')">↓</button></th>
      <th>Título en trámite <button onclick="ordenarPor('titulo_en_tramite')">↓</button></th>
      <th>Egreso <button onclick="ordenarPor('egreso')">↓</button></th>
      <th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = '/api/alumnos';
    let ordenarPorAtributo = null;

    let alumnos = [];

    async function actualizarTabla(){
      const tbody = document.querySelector('#alumnosTable tbody');
      tbody.innerHTML = '';
      alumnos.forEach(a => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${a.lu}</td>
          <td>${a.nombre}</td>
          <td>${a.apellido}</td>
          <td>${a.titulo || ''}</td>
          <td>${a.titulo_en_tramite || ''}</td>
          <td>${a.egreso || ''}</td>
          <td>
            <button onclick="editarAlumno('${a.lu}', '${a.nombre}', '${a.apellido}', '${a.titulo}', '${a.titulo_en_tramite}', '${a.egreso}')">Editar</button>
            <button onclick="eliminarAlumno('${a.lu}')">Borrar</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    async function ordenarPor(atributo) {
      ordenarPorAtributo = atributo;
      alumnos.sort((a, b) => {
            const valorA = (a[atributo] || '').toString().toLowerCase();
            const valorB = (b[atributo] || '').toString().toLowerCase();

            if (valorA === '') return 1;
            if (valorB === '') return -1;

            return valorA < valorB ? -1 :
                    valorB < valorA ? 1 :
                    0;
      });
      actualizarTabla();
    }

    async function cargarAlumnos() {
      const url = API_URL;
      const res = await fetch(url);
      alumnos = await res.json();
      actualizarTabla();
    }

    async function eliminarAlumno(lu) {
      if (!confirm('¿Seguro que deseas borrar este alumno?')) return;
      await fetch(`${API_URL}/${encodeURIComponent(lu)}`, { method: 'DELETE' });
      cargarAlumnos();
    }

    async function editarAlumno(lu, nombre, apellido, titulo, titulo_en_tramite, egreso) {
      const nuevoNombre = prompt('Nombre:', nombre);
      const nuevoApellido = prompt('Apellido:', apellido);
      const nuevoTitulo = prompt('Título:', titulo);
      const nuevoTramite = prompt('Título en trámite:', titulo_en_tramite);
      const nuevoEgreso = prompt('Egreso:', egreso);
      if (!nuevoNombre || !nuevoApellido) return;
      await fetch(`${API_URL}/${encodeURIComponent(lu)}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          lu: lu,
          nombre: nuevoNombre,
          apellido: nuevoApellido,
          titulo: nuevoTitulo,
          titulo_en_tramite: nuevoTramite,
          egreso: nuevoEgreso
        })
      });
      cargarAlumnos();
    }

    document.getElementById('alumnoForm').addEventListener('submit', async e => {
      e.preventDefault();
      const alumno = {
        lu: document.getElementById('lu').value,
        nombre: document.getElementById('nombre').value,
        apellido: document.getElementById('apellido').value,
        titulo: document.getElementById('titulo').value,
        titulo_en_tramite: document.getElementById('titulo_en_tramite').value,
        egreso: document.getElementById('egreso').value
      };
      await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(alumno)
      });
      e.target.reset();
      cargarAlumnos();
    });

    cargarAlumnos();
  </script>
</body>
</html>

