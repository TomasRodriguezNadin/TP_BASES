<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Alumnos</title>
  <style>
    table { border-collapse: collapse; width: 90%; margin: 20px auto; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: left; }
    form { margin: 20px auto; width: 90%; display: flex; gap: 10px; flex-wrap: wrap; }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Lista de Alumnos</h2>

  <form id="Form">
    #[Form]
    <button type="submit">Agregar Alumno</button>
  </form>

  <table id="Table">
    <thead>
      <tr>
      #[Table]
      <th>acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = '/api/alumnos';
    let ordenarPorAtributo = null;

    let filas = [];

    async function actualizarTabla(){
      const tbody = document.querySelector('#Table tbody');
      tbody.innerHTML = '';
      filas.forEach(f => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${f.lu}</td>
          <td>${f.nombre}</td>
          <td>${f.apellido}</td>
          <td>${f.titulo || ''}</td>
          <td>${f.titulo_en_tramite || ''}</td>
          <td>${f.egreso || ''}</td>
          <td>
            <button onclick="editarAlumno('${f.lu}', '${f.nombre}', '${f.apellido}', '${f.titulo}', '${f.titulo_en_tramite}', '${f.egreso}')">Editar</button>
            <button onclick="eliminarAlumno('${a.lu}')">Borrar</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    async function ordenarPor(atributo) {
      ordenarPorAtributo = atributo;
      filas.sort((a, b) => {
            const valorA = (a[atributo] || '').toString().toLowerCase();
            const valorB = (b[atributo] || '').toString().toLowerCase();

            if (valorA === '') return 1;
            if (valorB === '') return -1;

            return valorA < valorB ? -1 :
                    valorB < valorA ? 1 :
                    0;
      });
      actualizarTabla();
    }

    async function cargarAlumnos() {
      const url = API_URL;
      const res = await fetch(url);
      filas = await res.json();
      actualizarTabla();
    }

    async function eliminarAlumno(lu) {
      if (!confirm('¿Seguro que deseas borrar este elemento?')) return;
      await fetch(`${API_URL}/${encodeURIComponent(lu)}`, { method: 'DELETE' });
      cargarAlumnos();
    }

    async function editarAlumno(lu, nombre, apellido, titulo, titulo_en_tramite, egreso) {
      const nuevoNombre = prompt('Nombre:', nombre);
      const nuevoApellido = prompt('Apellido:', apellido);
      const nuevoTitulo = prompt('Título:', titulo);
      const nuevoTramite = prompt('Título en trámite:', titulo_en_tramite);
      const nuevoEgreso = prompt('Egreso:', egreso);
      if (!nuevoNombre || !nuevoApellido) return;
      await fetch(`${API_URL}/${encodeURIComponent(lu)}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          lu: lu,
          nombre: nuevoNombre,
          apellido: nuevoApellido,
          titulo: nuevoTitulo,
          titulo_en_tramite: nuevoTramite,
          egreso: nuevoEgreso
        })
      });
      cargarAlumnos();
    }

    document.getElementById('Form').addEventListener('submit', async e => {
      e.preventDefault();
      const fila = {
        lu: document.getElementById('lu').value,
        nombre: document.getElementById('nombre').value,
        apellido: document.getElementById('apellido').value,
        titulo: document.getElementById('titulo').value,
        titulo_en_tramite: document.getElementById('titulo_en_tramite').value,
        egreso: document.getElementById('egreso').value
      };
      await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(fila)
      });
      e.target.reset();
      cargarAlumnos();
    });

    cargarAlumnos();
  </script>
</body>
</html>

